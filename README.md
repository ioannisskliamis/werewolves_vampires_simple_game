# werewolves_vampires_simple_game

Was a group project

1) Περιγραφή προγράμματος/κώδικα
   
• Η αναλυτική περιγραφή του κώδικα βρίσκεται στην επόμενη σελίδα.
d) Παραδοχές
• Το αρχικό επίπεδο υγείας των Vampires/Werewolves είναι προκαθορισμένο, ίδιο για όλες τις
οντότητες και έχει την τιμή 4.
• Ένας ολοκληρωμένος γύρος του παιχνιδιού ξεκινάει με μία κίνηση του Avatar και συνεχίζει
με μία κίνηση από κάθε ζωντανή οντότητα (εναλλάξ ένας Vampire και ένας Werewolf).
• Μία οντότητα πρώτα επιλέγει τυχαία αν θα γιατρέψει τους γειτονικούς συμμάχους που δεν
έχουν πλήρη υγεία και επιτίθεται σε όλους του γειτονικούς αντιπάλους που έχουν μικρότερη
επίθεση από αυτήν. Στη συνέχεια, δέχεται επίθεση από έναν γειτονικό αντίπαλο με
μεγαλύτερη επίθεση από αυτήν και επιλέγει τυχαία αν θα προσπαθήσει να αποδράσει ή όχι.
• Η προσπάθεια απόδρασης μπορεί να γίνει σε οποιαδήποτε κατεύθυνση και δεν είναι
απαραίτητο το θα απομακρύνει την οντότητα από τον επιτιθέμενο.
• Αν μια οντότητα Α επιτεθεί σε μία οντότητα Β, αλλά η άμυνα της Β είναι μεγαλύτερη ή ίση
με την επίθεση της Α, η επίθεση θα γίνει αλλά δεν θα μειωθεί η υγεία της οντότητας B.
• To Avatar έχει τη δυνατότητα να κινηθεί μία φορά στην αρχή του κάθε γύρου και μόνο τότε
μπορεί να κάνει παύση/διακοπή του παιχνιδιού ή να γιατρέψει την ομάδα του.
• Το Avatar ξεκινάει τυχαία με 1 ή 2 γιατρικά.
• Το Avatar έχει τη δυνατότητα να μείνει στην ίδια θέση με τη χρήση του πλήκτρου SPACE.
• Η μέρα και η νύχτα εναλλάσσονται ανά 5 ολοκληρωμένους γύρους του παιχνιδιού. Η
αρχική επιλογή ανάμεσα τους είναι τυχαία.
• Οι Werewolves δεν μπορούν να επιτεθούν διαγώνια.
• Στην εκτέλεση του παιχνιδιού υπάρχουν τα εξής σύμβολα: A = Avatar, Vi = Vampire, Wi =
Werewolf (όπου i = 1, 2, 3…), P = Health Potion (γιατρικό), Τ = Tree, R = River (νερό),
* = νόμιμη θέση (γη).
• Το κάθε σύμβολο έχει διαφορετικό χρώμα. Το Avatar έχει το ίδιο χρώμα με την ομάδα που
υποστηρίζει.

2) Αναφορά IDE/Compiler/OS: Sublime Text Editor, g++ και makefile, Linux.

3) Αναλυτική Περιγραφή Κώδικα/Προγράμματος
   
Οδηγίες: Η μεταγλώττιση του κώδικα γίνεται από τον κατάλογο “source_code” με την εντολή
make. Η εντολή αυτή παράγει το εκτελέσιμο αρχείο main. Η εντολή make clean διαγράφει το
εκτελέσιμο αρχείο και όλα τα αρχεία αντικείμενου κώδικα (.ο). Η συμπεριφορά αυτή ορίζεται στο
αρχείο makefile.

Ιεραρχία Κλάσεων: Οι οντότητες του παιχνιδιού έχουν ως κοινό πρόγονο την αφηρημένη κλάση
Being. Από αυτήν κληρονομούν τον αριθμό των φίλτρων και τις μεταβλητές x, y που
αντιπροσωπεύουν της συντεταγμένες μιας οντότητας στο χάρτη. Επίσης κληρονομούν και τις
συναρτήσεις πρόσβασης/μεταβολής αυτών των μεταβλητών και την εικονική συνάρτηση play_turn
που καθορίζει τη συμπεριφορά μιας οντότητας όταν έρχεται η σειρά της.
Η κλάση Avatar κληρονομεί από την κλάση Being και αλλάζει πολυμορφικά τη συνάρτηση
play_turn. Μέσα από αυτήν τη συνάρτηση, το Avatar μπορεί να γιατρέψει τον ομάδα του και να
κάνει παύση ή διακοπή του παιχνιδιού. Ακόμα, η κλάση Avatar έχει τη συνάρτηση get_move η
οποία διαβάζει ένα πλήκτρο που πατάει ο χρήστης μέχρι αυτός να πατήσει ή ένα από τα βελάκια ή
το SPACE και επιστρέφει ένα ζεύγος ακέραιων συντεταγμένων. Τα βελάκια εμφανίζονται σαν
είσοδος με την μορφή ^[[i, όπου i ένα από τα γράμματα A, B, C, D. Οπότε, η συνάρτηση αρχικά
προσπερνάει τους πρώτους χαρακτήρες και μετά επιλέγει τις συντεταγμένες της σωστής θέσης με
βάση το γράμμα. Με το SPACE σαν είσοδο, το Avatar παραμένει στην ίδια θέση. Αυτή η επιλογή
υπάρχει γιατί το Avatar μπορεί να εγκλωβιστεί προσωρινά από μία κινούμενη οντότητα και τα
εμπόδια που υπάρχουν στο χάρτη ή μπορεί απλά να το συμφέρει να μείνει ακίνητο.
Η κλάση Creature είναι επίσης απόγονος της κλάσης Being αλλά έχει πολλά πρόσθετα στοιχεία.
Στο protected τμήμα της υπάρχουν οι μεταβλητές που χρειάζεται μια οντότητα για να παίξει το
παιχνίδι. Η μεταβλητή id δημιουργεί ένα μοναδικό αριθμό που προσδιορίζει ένα Werewolf ή ένα
Vampire. Η σταθερά max_health προσδιορίζει το αρχικό επίπεδο υγείας μια οντότητας και
χρησιμοποιείται για να διαπιστωθεί αν ένας σύμμαχος χρειάζεται γιατρειά ή όχι. Η συνάρτηση
attack είναι υπεύθυνη για την επίθεση σε μία ζωντανή οντότητα με χαμηλότερη δύναμη επίθεσης.
Αν η άμυνα του αντιπάλου είναι μεγαλύτερη ή ίση της δύναμης επίθεσης του επιτιθέμενου, η
επίθεση γίνεται αλλά το επίπεδο υγείας του αντιπάλου δεν μειώνεται. Η συνάρτηση counter_attack
είναι υπεύθυνη για την επίθεση ενός γειτονικού αντιπάλου με μεγαλύτερη δύναμη επίθεσης στην
οντότητα που έχει σειρά. Πρακτικά, καλεί την attack για τον αντίπαλο με όρισμα την οντότητα που
έχει σειρά. Η heal αποφασίζει τυχαία αν θα γιατρευτεί ένας γειτονικός σύμμαχος με επίπεδο υγείας
χαμηλότερο από το αρχικό. Η play_turn παίρνει σαν όρισμα έναν πίνακα από οντότητες. Για κάθε
μία, επιλέγει αν πρέπει να γίνει επίθεση ή γιατρειά. Η συνάρτηση επιτρέπει το πολύ ένα
counter_attack κάθε φορά. Η εικονική συνάρτηση get_moves περνάει στις δύο υποκλάσεις.
Οι κλάσεις Vampire και Werewolf είναι οι τελευταίες κλάσεις τις ιεραρχίας και είναι
πανομοιότυπες. Και οι δύο έχουν μία static μεταβλητή που μετράει πόσες οντότητες από κάθε
κλάση είναι ακόμα ζωντανές και τις αντίστοιχες συναρτήσεις για τη χρήση αυτής της μεταβλητής.
Και οι δύο κλάσεις αλλάζουν πολυμορφικά τη συνάρτηση get_moves που κληρονομούν από την
κλάση Creature. Η συνάρτηση αυτή επιστρέφει ένα δείκτη σε ζεύγη ακεραίων που αναπαριστούν
τις συντεταγμένες όλων των πιθανών κινήσεων που μπορούν να κάνουν οι οντότητες. Για τους
Werewolves υπάρχουν μόνο οι θέσεις που βρίσκονται κατακόρυφα και οριζόντια ενώ για τους
Vampires υπάρχουν και οι θέσεις που βρίσκονται διαγώνια. Όπως θα δούμε παρακάτω η κλάση
Game είναι υπεύθυνη για τη σωστή χρήση αυτών των συναρτήσεων.
Χάρτης και οπτικοποίηση: Η κλάση Node είναι η κλάση που μοντελοποιεί μία θέση στο χάρτη.
Έχει τις δικές τις συντεταγμένες, μια μεταβλητή τύπου floor (enum που έχουμε ορίσει εμείς) για να
προσδιορίσει αν είναι θέση γης, νερού ή δέντρου, μια μεταβλητή που δείχνει αν στη θέση αυτή
υπάρχει γιατρικό, δύο δείκτες (σε Creature και Avatar) που χρησιμοποιούνται για την είσοδο μιας
οντότητας σε αυτή τη θέση και ένα σύμβολο που χρησιμοποιείται για την οπτικοποίηση αυτής της
θέσης. Επιλέξαμε τους δύο ξεχωριστούς δείκτες αντί του ενός δείκτη σε Being γιατί χρειαζόμαστε
πρόσβαση στις συναρτήσεις που δεν κληρονομούνται από την κλάση Being μέσα από τη θέση του
χάρτη. Αν βάζαμε έναν δείκτη σε Being, θα έπρεπε να έχουμε δηλώσει πολλές συναρτήσεις σαν
εικονικές στο Being που θα κληρονομούσε και το Avatar που όμως δεν θα του ήταν απαραίτητες.
Στον constructor αυτής της κλάσης επιλέγεται τυχαία το υλικό της θέσης του χάρτη. Η βοηθητική
συνάρτηση randomize καθορίζει την πιθανότητα μία θέση να έχει εμπόδιο ή να αποτελείται από γη.
Εκτός από τις συναρτήσεις πρόσβασης/μεταβολής, η κλάση Node περιλαμβάνει τις συναρτήσεις
της μορφής enter και exit που χρησιμοποιούνται κατά την κίνηση των οντοτήτων. Είναι σημαντικό
να αναφερθεί και η συνάρτηση print_color_visual η οποία εκτυπώνει στην οθόνη το σύμβολο ενός
κόμβου με το σωστό χρώμα χρησιμοποιώντας μόνο ANSI Color Codes. Δεν έχουμε
χρησιμοποιήσει κάποια πρόσθετη βιβλιοθήκη για τη δημιουργία του γραφικού περιβάλλοντος του
παιχνιδιού.
Η κλάση Map αναπαριστά το χάρτη του παιχνιδιού. Ουσιαστικά περιέχει δύο ακέραιες διαστάσεις,
έναν δισδιάστατο πίνακα από αντικείμενα της κλάσης Node και μία static μεταβλητή για την
εναλλαγή της μέρας με τη νύχτα. Στον constructor της κλάσης επιλέγεται τυχαία η μέρα ή η νύχτα,
δημιουργείται ο πίνακας από Node και τοποθετείται το φίλτρο σε μία τυχαία θέση. Οι συναρτήσεις
place_creatures και place_avatar τοποθετούν μία ομάδα πλασμάτων και το Avatar σε τυχαίες
έγκυρες θέσεις του χάρτη. Η συνάρτηση print εκτυπώνει το χάρτη με τα σωστά χρώματα για τα
σύμβολα, την ώρα της μέρας και δημιουργεί το χώρο για τα μηνύματα που εμφανίζονται κατά τη
διάρκεια του παιχνιδιού.

Λειτουργία του παιχνιδιού: Ο συγχρονισμός των κινήσεων του παιχνιδιού και η συνολική του
λειτουργία προσδιορίζεται από την κλάση Game. Στον constructor της δημιουργούνται ο χάρτης
και όλες οι οντότητες. Με τις συναρτήσεις move_creature και move_avatar επιτυγχάνεται η
μετακίνηση των οντοτήτων στο χάρτη. Η move_creature πρώτα χρησιμοποιεί τη get_moves ενός
Creature για να πάρει όλες τις πιθανές κινήσεις του. Μετά δημιουργεί ένα πίνακα με όσες από
αυτές τις κινήσεις είναι έγκυρες (εντός χάρτη, σε ελεύθερη θέση και χωρίς εμπόδιο). Διαλέγει
τυχαία μία από αυτές και μετακινεί το Creature. Ομοίως λειτουργεί και η move_avatar. Η kill
αφαιρεί από τον χάρτη ένα Creature με επίπεδο υγείας 0 και ενημερώνει τους πίνακες και τις
στατικές μεταβλητές. Χρησιμοποιείται από την dead_creatures που ελέγχει ποιες οντότητες
πέθαναν μετά από κάθε κίνηση. Η prepare_turn δημιουργεί τον πίνακα με τις γειτονικές οντότητες
που χρησιμοποιεί μία οντότητα όταν είναι η σειρά της. Η play_round ξεκινά με την κίνηση του
Avatar και συνεχίζει κουνώντας εναλλάξ τις οντότητες των δύο ομάδων. Μετά την κίνηση κάθε
οντότητας ελέγχει αν πέθαναν κάποιες οντότητες, αν κάποια οντότητα πρέπει να απομακρυνθεί
μετά από κάποια επίθεση που μπορεί να δέχτηκε και αν κέρδισε μία ομάδα. Τέλος, η συνάρτηση
start είναι υπεύθυνη για το ξεκίνημα και τον τερματισμό του παιχνιδιού. Σε όλο το παιχνίδι
εκτυπώνονται μηνύματα που εξηγούν ποια κίνηση λαμβάνει χώρα κάθε φορά και τις επιπτώσεις
που έχει στην υγεία των οντοτήτων.
